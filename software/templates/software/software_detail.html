<!DOCTYPE html>
<html lang="en">
     {% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>{{ software.title }} v{{ software.version }} - Download Free Software | Software Portal</title>
    <meta name="title" content="{{ software.title }} v{{ software.version }} - Download Free Software | Software Portal">
    <meta name="description" content="Download {{ software.title }} v{{ software.version }} for free. {{ software.description|truncatewords:25|striptags }} Available for immediate download with {{ software.download_count }} downloads.">
    <meta name="keywords" content="{{ software.title }}, {{ software.version }}, {% if software.category %}{{ software.category.name }}, {% endif %}free software, download, {{ software.title|lower }} download, software portal">
    <meta name="author" content="Software Portal">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{ request.build_absolute_uri }}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:title" content="{{ software.title }} v{{ software.version }} - Free Download">
    <meta property="og:description" content="Download {{ software.title }} v{{ software.version }} for free. {{ software.description|truncatewords:25|striptags }} {{ software.download_count }} downloads available.">
    {% if software.thumbnail %}
    <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ software.thumbnail.url }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="{{ software.title }} v{{ software.version }} preview">
    {% else %}
    <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'icon/favicon.ico' %}">
    {% endif %}
    <meta property="og:site_name" content="Software Portal">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ request.build_absolute_uri }}">
    <meta property="twitter:title" content="{{ software.title }} v{{ software.version }} - Free Download">
    <meta property="twitter:description" content="Download {{ software.title }} v{{ software.version }} for free. {{ software.description|truncatewords:25|striptags }}">
    {% if software.thumbnail %}
    <meta property="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{{ software.thumbnail.url }}">
    <meta property="twitter:image:alt" content="{{ software.title }} v{{ software.version }} preview">
    {% else %}
    <meta property="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'icon/favicon.ico' %}">
    {% endif %}
    
    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#3B82F6">
    <meta name="msapplication-TileColor" content="#3B82F6">
    <meta name="application-name" content="Software Portal">
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "{{ software.title }}",
        "version": "{{ software.version }}",
        "description": "{{ software.description|striptags|escapejs }}",
        "url": "{{ request.build_absolute_uri }}",
        {% if software.thumbnail %}
        "image": "{{ request.scheme }}://{{ request.get_host }}{{ software.thumbnail.url }}",
        {% endif %}
        "downloadUrl": "{{ request.scheme }}://{{ request.get_host }}{% url 'software:software_download' software.pk %}",
        "datePublished": "{{ software.upload_date|date:'c' }}",
        "dateModified": "{{ software.upload_date|date:'c' }}",
        "publisher": {
            "@type": "Organization",
            "name": "Software Portal",
            "url": "{{ request.scheme }}://{{ request.get_host }}"
        },
        {% if software.category %}
        "applicationCategory": "{{ software.category.name }}",
        {% endif %}
        "operatingSystem": "Windows, macOS, Linux",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD",
            "availability": "https://schema.org/InStock"
        },
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.5",
            "ratingCount": "{{ software.download_count }}"
        },
        "interactionStatistic": {
            "@type": "InteractionCounter",
            "interactionType": "https://schema.org/DownloadAction",
            "userInteractionCount": "{{ software.download_count }}"
        }
    }
    </script>
    
    <!-- Breadcrumb Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'software:software_list' %}"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "Software",
                "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'software:software_list' %}"
            }{% if software.category %},
            {
                "@type": "ListItem",
                "position": 3,
                "name": "{{ software.category.name }}",
                "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'software:software_list' %}?category={{ software.category.pk }}"
            },
            {
                "@type": "ListItem",
                "position": 4,
                "name": "{{ software.title }}",
                "item": "{{ request.build_absolute_uri }}"
            }{% else %},
            {
                "@type": "ListItem",
                "position": 3,
                "name": "{{ software.title }}",
                "item": "{{ request.build_absolute_uri }}"
            }{% endif %}
        ]
    }
    </script>
    
    <!-- Favicons and Icons -->
    <link rel="shortcut icon" href="{% static 'icon/favicon.ico' %}" type="image/x-icon">
    <link rel="icon" type="image/x-icon" href="{% static 'icon/favicon.ico' %}">
    <link rel="apple-touch-icon" href="{% static 'icon/favicon.ico' %}">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- CSS and JavaScript -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#1E40AF',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 min-h-screen" x-data="{ showFullDescription: false, imageLoaded: false }">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="{% url 'software:software_list' %}" class="flex items-center space-x-3">
                        <i class="fas fa-cube text-2xl text-primary"></i>
                        <span class="text-xl font-bold text-gray-800">Software Portal</span>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="{% url 'software:software_list' %}" 
                       class="text-gray-600 hover:text-primary transition-colors flex items-center">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Back to Software List
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Breadcrumb -->
        <nav class="flex mb-8" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a href="{% url 'software:software_list' %}" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-primary">
                        <i class="fas fa-home mr-2"></i>
                        Home
                    </a>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                        <a href="{% url 'software:software_list' %}" class="ml-1 text-sm font-medium text-gray-700 hover:text-primary md:ml-2">Software</a>
                    </div>
                </li>
                {% if software.category %}
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                        <a href="{% url 'software:software_list' %}?category={{ software.category.pk }}" class="ml-1 text-sm font-medium text-gray-700 hover:text-primary md:ml-2">{{ software.category.name }}</a>
                    </div>
                </li>
                {% endif %}
                <li aria-current="page">
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                        <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2">{{ software.title }}</span>
                    </div>
                </li>
            </ol>
        </nav>

        <!-- Software Header -->
        <div class="bg-white rounded-lg shadow-md p-8 mb-8">
            <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between">
                <div class="flex-1">
                    <h1 class="text-4xl font-bold text-gray-900 mb-4">{{ software.title }}</h1>
                    <div class="flex flex-wrap items-center gap-4 mb-6">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                            <i class="fas fa-tag mr-2"></i>
                            Version {{ software.version }}
                        </span>
                        {% if software.category %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800">
                            <i class="fas fa-folder mr-2"></i>
                            {{ software.category.name }}
                        </span>
                        {% endif %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                            <i class="fas fa-download mr-2"></i>
                            {{ software.download_count }} downloads
                        </span>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                            <i class="fas fa-calendar mr-2"></i>
                            {{ software.upload_date|date:"M d, Y" }}
                        </span>
                    </div>
                </div>
                <div class="lg:ml-8 mt-6 lg:mt-0">
                    <a href="{% url 'software:software_download' software.pk %}" 
                       class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold rounded-lg hover:from-green-700 hover:to-emerald-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                        <i class="fas fa-download mr-3 text-xl"></i>
                        Download Now
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Thumbnail -->
                {% if software.thumbnail %}
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-image mr-3 text-primary"></i>
                        Preview
                    </h2>
                    <div class="relative">
                        <div x-show="!imageLoaded" class="w-full aspect-video bg-gray-200 rounded-lg flex items-center justify-center">
                            <div class="animate-pulse flex items-center justify-center w-full h-full">
                                <i class="fas fa-image text-4xl text-gray-400"></i>
                            </div>
                        </div>
                        <img src="{{ software.thumbnail.url }}" 
                             alt="{{ software.title }} thumbnail"
                             class="w-full aspect-video object-cover rounded-lg shadow-md"
                             x-show="imageLoaded"
                             @load="imageLoaded = true"
                             @error="imageLoaded = true; console.error('Failed to load image:', '{{ software.thumbnail.url }}');"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div class="w-full aspect-video bg-gray-200 rounded-lg flex items-center justify-center text-gray-500" style="display: none;">
                            <div class="text-center">
                                <i class="fas fa-exclamation-triangle text-4xl mb-2"></i>
                                <p>Image not available</p>
                                <p class="text-sm">{{ software.thumbnail.url }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-image mr-3 text-primary"></i>
                        Preview
                    </h2>
                    <div class="w-full aspect-video bg-gray-200 rounded-lg flex items-center justify-center text-gray-500">
                        <div class="text-center">
                            <i class="fas fa-image text-4xl mb-2"></i>
                            <p>No preview available</p>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Description -->
                <div class="bg-gray-50 rounded-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-info-circle mr-3 text-primary"></i>
                        Description
                    </h2>
                    <div class="prose prose-gray max-w-none">
                        <div x-show="!showFullDescription" class="relative">
                            <p class="text-gray-700 leading-relaxed">
                                {{ software.description|truncatewords:50 }}
                            </p>
                            {% if software.description|length > 300 %}
                            <div class="absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-gray-50 to-transparent"></div>
                            {% endif %}
                        </div>
                        <div x-show="showFullDescription">
                            <p class="text-gray-700 leading-relaxed whitespace-pre-line">{{ software.description }}</p>
                        </div>
                        {% if software.description|length > 300 %}
                        <button @click="showFullDescription = !showFullDescription" 
                                class="mt-4 text-primary hover:text-secondary font-medium transition-colors">
                            <span x-show="!showFullDescription">Read More <i class="fas fa-chevron-down ml-1"></i></span>
                            <span x-show="showFullDescription">Read Less <i class="fas fa-chevron-up ml-1"></i></span>
                        </button>
                        {% endif %}
                    </div>
                </div>

                <!-- File Information -->
                <div class="bg-blue-50 rounded-lg p-6 border border-blue-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-file-alt mr-3 text-blue-600"></i>
                        File Information
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex items-center justify-between p-3 bg-white rounded-lg">
                            <span class="text-gray-600">File Name:</span>
                            <span class="font-medium text-gray-800">{{ software.file.name|default:"N/A" }}</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Version:</span>
                            <span class="font-medium text-gray-800">{{ software.version }}</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Upload Date:</span>
                            <span class="font-medium text-gray-800">{{ software.upload_date|date:"M d, Y" }}</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-white rounded-lg">
                            <span class="text-gray-600">Last Updated:</span>
                            <span class="font-medium text-gray-800">{{ software.updated_at|date:"M d, Y" }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Download Card -->
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 border border-green-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-download mr-3 text-green-600"></i>
                        Download
                    </h3>
                    <div class="space-y-4">
                        <div class="text-center">
                            <div class="text-3xl font-bold text-green-600 mb-1">{{ software.download_count }}</div>
                            <div class="text-sm text-gray-600">Total Downloads</div>
                        </div>
                        <a href="{% url 'software:software_download' software.pk %}" 
                           class="w-full inline-flex items-center justify-center px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-1">
                            <i class="fas fa-download mr-3"></i>
                            Download Now
                        </a>
                        <p class="text-xs text-gray-500 text-center">
                            Free download â€¢ No registration required
                        </p>
                    </div>
                </div>

                <!-- Category Card -->
                {% if software.category %}
                <div class="bg-purple-50 rounded-lg p-6 border border-purple-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-folder mr-3 text-purple-600"></i>
                        Category
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-800">{{ software.category.name }}</span>
                        </div>
                        {% if software.category.description %}
                        <p class="text-sm text-gray-600">{{ software.category.description }}</p>
                        {% endif %}
                        <a href="{% url 'software:software_list' %}?category={{ software.category.pk }}" 
                           class="inline-flex items-center text-purple-600 hover:text-purple-700 font-medium text-sm transition-colors">
                            View more in this category
                            <i class="fas fa-arrow-right ml-2"></i>
                        </a>
                    </div>
                </div>
                {% endif %}

                <!-- Uploader Info -->
                {% if software.uploader %}
                <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-user mr-3 text-gray-600"></i>
                        Uploader
                    </h3>
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-primary rounded-full flex items-center justify-center text-white font-bold text-lg">
                            {{ software.uploader.username|first|upper }}
                        </div>
                        <div>
                            <div class="font-medium text-gray-800">{{ software.uploader.username }}</div>
                            <div class="text-sm text-gray-600">
                                {% if software.uploader.first_name %}
                                    {{ software.uploader.first_name }} {{ software.uploader.last_name }}
                                {% else %}
                                    Software Contributor
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Share Card -->
                <div class="bg-orange-50 rounded-lg p-6 border border-orange-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-share-alt mr-3 text-orange-600"></i>
                        Share
                    </h3>
                    <div class="flex space-x-3">
                        <button onclick="navigator.share ? navigator.share({title: '{{ software.title }}', url: window.location.href}) : copyToClipboard(window.location.href)" 
                                class="flex-1 bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors text-sm font-medium">
                            <i class="fas fa-share mr-2"></i>Share
                        </button>
                        <button onclick="copyToClipboard(window.location.href)" 
                                class="flex-1 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm font-medium">
                            <i class="fas fa-copy mr-2"></i>Copy Link
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Software Section -->
        <div class="mt-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-th-large mr-3 text-primary"></i>
                Related Software
            </h2>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="text-center text-gray-500 py-8">
                    <i class="fas fa-search text-4xl mb-4"></i>
                    <p>Related software will be displayed here</p>
                    <a href="{% url 'software:software_list' %}" class="inline-flex items-center mt-4 text-primary hover:text-secondary font-medium">
                        Browse All Software
                        <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p>&copy; {% now "Y" %} Software Portal by Tanvir. All rights reserved.</p>
        </div>
    </footer>

    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                // You could add a toast notification here
                alert('Link copied to clipboard!');
            }, function(err) {
                console.error('Could not copy text: ', err);
            });
        }
    </script>
</body>
</html>